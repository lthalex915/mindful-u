<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindfulU - Stress Monitoring</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Ubuntu+Sans:ital,wght@0,100..800;1,100..800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="stress-monitoring.css">
    <link rel="stylesheet" href="notification.css">
    <script defer src="https://cdn.jsdelivr.net/npm/face-api.js@0.22.2/dist/face-api.min.js"></script>
    <script src="notification.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">MindfulU</div>
        <div style="display: flex; align-items: center; gap: 16px;">
            <button id="openChatBtn" class="chat-button" title="Chat with AI">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                <span>Chat with AI</span>
            </button>
            <a href="tutorial.html#stress-emotions" class="tutorial-icon" title="Learn about stress monitoring" style="color: #718096; text-decoration: none; display: flex; align-items: center; gap: 6px; font-size: 14px; font-weight: 500; transition: color 0.3s ease;">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                    <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <span>Tutorial</span>
            </a>
            <a href="portal.html" class="back-link">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
                Back to Portal
            </a>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Animated Gradient Blobs -->
        <div class="blob blob-1"></div>
        <div class="blob blob-2"></div>
        <div class="blob blob-3"></div>
        <div class="blob blob-4"></div>

        <!-- Content Container -->
        <div class="content-container">
            <h1 class="page-title">Stress Monitoring</h1>
            <p class="page-subtitle">Real-time facial expression analysis and stress level tracking</p>

            <!-- Stress Bar -->
            <div class="stress-bar-container">
                <div class="stress-bar-label">
                    Your Stress Level
                    <span class="stress-disclaimer-icon" title="This stress level is estimated based on facial expressions. It is not a medical diagnosis and should be used as a general reference only.">‚ìò</span>
                </div>
                <div class="stress-bar-wrapper">
                    <div class="stress-bar" id="stressBar"></div>
                    <span class="stress-percentage" id="stressPercentage">0%</span>
                </div>
                <div class="stress-disclaimer">
                    <small>
                        ‚ö†Ô∏è This stress detection is based on AI analysis of facial expressions. It provides a general reference only and is not medically accurate. Results may vary and should not be used for diagnosis.
                    </small>
                </div>
            </div>

            <!-- Monitoring Grid -->
            <div class="monitoring-grid">
                <!-- Video Feed -->
                <div class="video-section">
                    <div class="video-container" id="videoContainer">
                        <video id="videoFeed" autoplay muted playsinline></video>
                        <canvas id="videoCanvas"></canvas>
                        <div class="camera-overlay" id="cameraOverlay">
                            <svg class="camera-icon" width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                <circle cx="12" cy="13" r="4"/>
                            </svg>
                            <p class="camera-text">Click to start camera</p>
                        </div>
                        <div class="loading-overlay" id="loadingOverlay" style="display: none;">
                            <div class="loading-spinner">
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                                <div class="spinner-ring"></div>
                            </div>
                            <p class="loading-text">Initializing detector...</p>
                            <p class="loading-subtext">Please wait while the AI model loads</p>
                        </div>
                        <div class="video-status" id="videoStatus" style="display: none;">Initializing camera...</div>
                    </div>
                </div>

                <!-- Emotion Details -->
                <div class="emotion-details-container">
                    <div class="emotion-header">
                        <h3>üòä Emotions</h3>
                    </div>
                    <div class="emotion-bars" id="emotionBars">
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üòä</span>
                                <span class="emotion-name">Happy</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="happyBar"></div>
                                <span class="emotion-value" id="happyValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üò¢</span>
                                <span class="emotion-name">Sad</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="sadBar"></div>
                                <span class="emotion-value" id="sadValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üò†</span>
                                <span class="emotion-name">Angry</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="angryBar"></div>
                                <span class="emotion-value" id="angryValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üò®</span>
                                <span class="emotion-name">Fearful</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="fearfulBar"></div>
                                <span class="emotion-value" id="fearfulValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üò≤</span>
                                <span class="emotion-name">Surprised</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="surprisedBar"></div>
                                <span class="emotion-value" id="surprisedValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">ü§¢</span>
                                <span class="emotion-name">Disgusted</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="disgustedBar"></div>
                                <span class="emotion-value" id="disgustedValue">0%</span>
                            </div>
                        </div>
                        <div class="emotion-item">
                            <div class="emotion-label">
                                <span class="emotion-icon">üòê</span>
                                <span class="emotion-name">Neutral</span>
                            </div>
                            <div class="emotion-bar-wrapper">
                                <div class="emotion-bar" id="neutralBar"></div>
                                <span class="emotion-value" id="neutralValue">0%</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Chat Popup Modal -->
    <div id="chatPopup" class="chat-popup">
        <!-- Overlay for mobile sidebar -->
        <div id="sidebarOverlay" class="sidebar-overlay"></div>

        <!-- Chat History Sidebar -->
        <div class="chat-history-sidebar collapsed">
            <div class="sidebar-header">
                <h3>Chat History</h3>
                <div class="sidebar-header-actions">
                    <button id="newChatBtn" class="new-chat-btn" title="Start new chat">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 5v14M5 12h14"/>
                        </svg>
                    </button>
                    <button id="closeSidebarBtn" class="close-sidebar-btn" title="Close">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="chat-history-list" id="chatHistoryList">
                <!-- Chat history items will be dynamically added here -->
            </div>
            <div class="sidebar-footer">
                <button id="deleteAllChatsBtn" class="delete-all-btn" title="Delete all chat history">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                    </svg>
                    Delete All Chats
                </button>
            </div>
        </div>

        <div class="chat-popup-container">
            <!-- Chat Header -->
            <div class="chat-popup-header">
                <!-- Mobile Toggle Button for Chat History -->
                <button id="toggleHistoryBtn" class="toggle-history-btn" title="Toggle chat history">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12h18M3 6h18M3 18h18"/>
                    </svg>
                    <span>Chat History</span>
                </button>

                <div class="chat-popup-title">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                    <h2>Chat with AI</h2>
                </div>
                <button id="closeChatBtn" class="close-chat-btn" title="Close chat">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Tone Selection -->
            <div class="chat-tone-selection">
                <label for="chatToneSelect" class="tone-label">Tone:</label>
                <select id="chatToneSelect" class="tone-select">
                    <option value="friendly">Friendly</option>
                    <option value="professional">Professional</option>
                    <option value="casual">Casual</option>
                    <option value="empathetic">Empathetic</option>
                    <option value="motivational">Motivational</option>
                </select>
                <button id="resetToneBtn" class="reset-tone-btn" title="Reset to default tone">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/>
                        <path d="M21 3v5h-5"/>
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/>
                        <path d="M8 16H3v5"/>
                    </svg>
                </button>
            </div>

            <!-- Chat Messages -->
            <div class="chat-popup-messages" id="chatPopupMessages">
                <!-- Messages will be dynamically added here -->
            </div>

            <!-- Chat Input -->
            <div class="chat-popup-input-container">
                <textarea
                    id="chatPopupInput"
                    placeholder="Share your daily life. AI is all ears ready for you."
                    autocomplete="off"
                    rows="1"
                ></textarea>
                <button id="chatPopupSendBtn" class="chat-popup-send-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <script src="chat-manager.js"></script>
    <script src="stress-monitoring.js"></script>
</body>
</html>
